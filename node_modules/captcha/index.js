var ccap = require('ccap')

var alg = 'sha1'
    ,check_empty = 'user_city'
    ,hash = 'chash'
    ,text = 'ctext'

exports.get = function(mem) {    
    var captcha = ccap()
        ,c = captcha.get()
        ,res = {img64: ''}
        
    res.img64 = c[1].toString('base64')
    mem.set('captcha_'+c[0], '1', function(er, res) {})
    return res;
}

exports.check = function(data, mem, callback) {  
    if(!data[text] || data[check_empty] !== '') {
        callback(false);
        return;
    }
    mem.get('captcha_'+data[text], function(e, r){
        callback(r && r === '1'? true:false)
        mem.delete('captcha_'+data[text], function(){})
    })
    return;
}