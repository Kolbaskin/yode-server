/**
 * Сборщик мусора
 * 
 * метод run:
 * dir -- каталог в котором ищем устаревшие файлы
 * durTime -- предельный возраст файла в секундах (вычисляется от последнего изменения)
 */
 
var fs = require('fs')

exports.run = function(dir, durTime) {
    
    var curDate = new Date()
    
    durTime *= 1000
    
    var checkFile = function(path) {
        fs.stat(path, function(e, s) {
             if((curDate - s.mtime) > durTime) {
                 fs.unlink(path)
             }
        })
    }
    
    
    
    fs.readdir(dir, function(e, files) {      
        if(files) for(var i=0;i<files.length;i++) {
            checkFile(dir + '/' + files[i])
        }
    })
    
}